{% extends "base.html" %}
{% block content %}
<div class="container py-4">
  <h2 class="mb-3">AI Captions (Hooks / Captions / CTAs / Hashtags)</h2>

  {% if error %}
  <div class="alert alert-danger">{{ error }}</div>
  {% endif %}

  <form method="POST" class="card shadow-sm mb-4">
    <div class="card-body row g-3">
      <div class="col-12 col-lg-6">
        <label class="form-label">Θέμα / Προϊόν</label>
        <input name="topic" class="form-control" value="{{ topic or '' }}" placeholder="π.χ. sneakers summer sale">
      </div>

      <div class="col-6 col-lg-3">
        <label class="form-label">Πλατφόρμα</label>
        <select name="platform" class="form-select">
          {% set platforms = ['Instagram','TikTok','Facebook','Pinterest'] %}
          {% for p in platforms %}
          <option value="{{ p }}" {{ 'selected' if platform==p else '' }}>{{ p }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="col-6 col-lg-3">
        <label class="form-label">Γλώσσα</label>
        <select name="lang" class="form-select">
          <option value="el" {{ 'selected' if lang=='el' else '' }}>Ελληνικά</option>
          <option value="en" {{ 'selected' if lang=='en' else '' }}>English</option>
        </select>
      </div>

      <div class="col-6 col-lg-3">
        <label class="form-label">Τόνος</label>
        <select name="tone" class="form-select">
          {% for t in ['energetic','friendly','luxury','minimal','funny','edgy'] %}
          <option value="{{ t }}" {{ 'selected' if tone==t else '' }}>{{ t }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="col-6 col-lg-2">
        <label class="form-label">Πόσα</label>
        <input type="number" min="3" max="20" step="1" name="n" value="{{ n or 6 }}" class="form-control">
      </div>

      <div class="col-6 col-lg-3">
        <label class="form-label">Kind</label>
        <select name="kind" class="form-select">
          {% set kinds = ['all','hooks','captions','ctas','hashtags'] %}
          {% for k in kinds %}
          <option value="{{ k }}" {{ 'selected' if kind==k else '' }}>{{ k|capitalize }}</option>
          {% endfor %}
        </select>
        <div class="form-text">All = εμφάνιση όλων. Τα άλλα φιλτράρουν.</div>
      </div>

      <div class="col-12 col-lg-7">
        <label class="form-label">Keywords</label>
        <input name="keywords" class="form-control" value="{{ keywords or '' }}" placeholder="π.χ. retro, limited, sale">
      </div>

      <div class="col-6 col-lg-2 form-check ms-3 mt-4">
        <input class="form-check-input" type="checkbox" name="emojis" id="emojis" {{ 'checked' if emojis else '' }}>
        <label class="form-check-label" for="emojis">Emojis</label>
      </div>

      <div class="col-6 col-lg-2 form-check mt-4">
        <input class="form-check-input" type="checkbox" name="hashtags" id="hashtags" {{ 'checked' if hashtags else '' }}>
        <label class="form-check-label" for="hashtags">Hashtags</label>
      </div>

      <div class="col-12">
        <button class="btn btn-primary">Generate</button>
      </div>
    </div>
  </form>

  {% if results %}
  <div class="row g-4">

    <!-- Hooks -->
    <div class="col-12 col-lg-4">
      <div class="card shadow-sm h-100">
        <div class="card-header d-flex justify-content-between align-items-center">
          <span class="fw-bold">Hooks</span>
          <button type="button" class="btn btn-sm btn-outline-secondary" onclick="copyList('hooksList')">Copy all</button>
        </div>
        <div class="card-body">
          {% if results.hooks and results.hooks|length %}
          <ol id="hooksList" class="ps-3">
            {% for ln in results.hooks %}
            <li class="mb-2 d-flex align-items-start">
              <span class="flex-grow-1 pe-2">{{ ln }}</span>
              <button type="button" class="btn btn-sm btn-light" onclick="copyText(`{{ ln|replace('`','\\`') }}`)">Copy</button>
            </li>
            {% endfor %}
          </ol>
          {% else %}
          <div class="text-muted">—</div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Captions -->
    <div class="col-12 col-lg-4">
      <div class="card shadow-sm h-100">
        <div class="card-header d-flex justify-content-between align-items-center">
          <span class="fw-bold">Captions</span>
          <button type="button" class="btn btn-sm btn-outline-secondary" onclick="copyList('capsList')">Copy all</button>
        </div>
        <div class="card-body">
          {% if results.captions and results.captions|length %}
          <ol id="capsList" class="ps-3">
            {% for ln in results.captions %}
            <li class="mb-2 d-flex align-items-start">
              <span class="flex-grow-1 pe-2">{{ ln }}</span>
              <button type="button" class="btn btn-sm btn-light" onclick="copyText(`{{ ln|replace('`','\\`') }}`)">Copy</button>
            </li>
            {% endfor %}
          </ol>
          {% else %}
          <div class="text-muted">—</div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- CTAs -->
    <div class="col-12 col-lg-4">
      <div class="card shadow-sm h-100">
        <div class="card-header d-flex justify-content-between align-items-center">
          <span class="fw-bold">CTAs</span>
          <button type="button" class="btn btn-sm btn-outline-secondary" onclick="copyList('ctasList')">Copy all</button>
        </div>
        <div class="card-body">
          {% if results.ctas and results.ctas|length %}
          <ol id="ctasList" class="ps-3">
            {% for ln in results.ctas %}
            <li class="mb-2 d-flex align-items-start">
              <span class="flex-grow-1 pe-2">{{ ln }}</span>
              <button type="button" class="btn btn-sm btn-light" onclick="copyText(`{{ ln|replace('`','\\`') }}`)">Copy</button>
            </li>
            {% endfor %}
          </ol>
          {% else %}
          <div class="text-muted">—</div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Hashtags -->
<div class="col-12">
  <div class="card shadow-sm">
    <div class="card-header d-flex justify-content-between align-items-center">
      <span class="fw-bold">Hashtags</span>
      <div>
        <button type="button" class="btn btn-sm btn-outline-secondary me-2"
                onclick="copyHashtags('#hashtagsBox','line')">Copy (line)</button>
        <button type="button" class="btn btn-sm btn-outline-secondary"
                onclick="copyHashtags('#hashtagsBox','grid')">Copy (one per line)</button>
      </div>
    </div>
    <div class="card-body">
      {% if results.hashtags and results.hashtags|length %}
      <pre id="hashtagsBox" class="mb-0" style="white-space: pre-wrap;">{{ hashtags_line }}</pre>
      {% else %}
      <div class="text-muted">—</div>
      {% endif %}
    </div>
  </div>
</div>


  </div>
  {% endif %}
</div>

<script>
function copyText(t){navigator.clipboard.writeText(t).catch(()=>{});}
function copyList(id){
  const el=document.getElementById(id); if(!el) return;
  const lines=[...el.querySelectorAll('li span:first-child')].map(s=>s.innerText.trim());
  navigator.clipboard.writeText(lines.join('\n'));
}
function copyHashtags(sel,mode){
  const box=document.querySelector(sel); if(!box) return;
  const raw=box.innerText.trim(); if(!raw) return;
  if(mode==='grid'){
    const parts=raw.split(/[\s]+/).filter(Boolean);
    navigator.clipboard.writeText(parts.join('\n'));
  } else { navigator.clipboard.writeText(raw); }
}
</script>
{% endblock %}
